<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- yarilab docs content -->
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>add visual</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <link rel="shortcut icon" href="/static/ico/favicon.png">        
        <link href="/static/css/bootstrap.css" rel="stylesheet" type="text/css" />
        <link href="/static/css/docs.css" rel="stylesheet" type="text/css" />
        <link href="/static/dashboard/css/font-awesome.css" rel="stylesheet" type="text/css" />         
        <!-- upload css stuff -->
        <link rel="stylesheet" href="http://blueimp.github.io/Gallery/css/blueimp-gallery.min.css">
        <link rel="stylesheet" href="/static/upload/css/jquery.fileupload.css">
        <link rel="stylesheet" href="/static/upload/css/jquery.fileupload-ui.css">        
        <!-- ./upload css stuff -->              
        <link href="/static/css/style.css" rel="stylesheet" type="text/css" />        
        <script src="/static/js/jquery-1.8.2.min.js"></script>
        <script src="/static/js/bootstrap.js"></script>          
        <script src="/static/js/app.js"></script>  
        <!-- bootstrap editable -->
        <link href="/static/css/bootstrap-editable.css" rel="stylesheet" type="text/css" />        
        <script src="/static/js/bootstrap-editable.js"></script>
        <!-- ./bootstrap editable -->          
        <script src="/static/js/jquery.nicescroll.min.js"></script>
    </head>
    
    <body data-spy="scroll" data-target=".bs-docs-sidebar" data-twttr-rendered="true">
        {% include "/header.html" %}
        <div class="container">     
            <br>
            <h1>Image Database Management</h1>
            <h2 class="lead">Query, Update, Analyse database </h2>
            <div>
                <ul class="nav nav-tabs">
                    <li class="active"><a href="/manage/projects/all">Update DB</a></li>
                    <li><a href="/query">Query DB</a></li>
                    <li><a href="/dashboard">Dashboard</a></li>
                </ul>
            </div>            

            <div class="row" >
                <div class="col-lg-8 col-md-offset-1">
                    <h2>Add visuals 
                        <small>
                            <a href="/manage/projects/all">Projects</a>/{{ project_name }}/<a href="/manage/visuals/edit/{{ project_id }}/all">visuals
                            </a>/
                        </small>
                    </h2>
                </div>    
                <div class="col-lg-3 col-md-offset-0" id="review-visuals">
                    <a class="btn" type="button" href="/manage/visuals/edit/{{ project_id }}/all"><i class="icon icon-arrow-left "></i>Review visuals</a>
                </div>     
			    <hr class="colorgraph">
                <blockquote>
                    Upload Notes:
                    <ul>
                            <li>The maximum visual image size for uploads is <strong>5 MB</strong>.</li>
                            <li>The maximum number of visual uploads at once is <strong>100</strong>.</li>
                            <li>Only image files (<strong>JPG, PNG</strong>) are allowed.</li>
                            <li>You can <strong>drag &amp; drop</strong> files from your desktop on this webpage.</li>
                        </ul>
                </blockquote>
                <form id="image-fileupload-form" action="#" method="POST" enctype="multipart/form-data">
                    <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
                    <div class="row fileupload-buttonbar">
                        <div class="col-lg-4 col-md-offset-1">
                            <!-- The fileinput-button span is used to style the file input field as button -->
                            <span class="btn btn-success fileinput-button">
                                <i class="icon icon-plus icon-white"></i>
                                <span>Add visuals...</span>
                                <input type="file" name="files[]" multiple>
                            </span>
                            <button type="button" class="btn btn-danger delete">
                                <i class="icon icon-trash icon-white"></i>
                                <span>Delete visuals</span>
                            </button>
                            <input type="checkbox" class="toggle">
                            <!-- The global file processing state -->
                            <span class="fileupload-process"></span>
                        </div>
                        <div class="col-lg-4 col-md-offset-3">
                            <button type="submit" class="btn btn-primary start">
                                <i class="icon icon-check icon-white"></i>
                                <span>Submit visuals</span>
                            </button>
                            <button type="reset" class="btn btn-default cancel">  
                                <i class="icon icon-ban-circle "></i>                              
                                <span>Cancel submit</span>
                            </button>                           
                        </div>
                        <!-- The global progress state -->
                        <div class="col-lg-5 fileupload-progress fade" style="clear:both;">
                            <!-- The global progress bar -->
                            <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar progress-bar-success" style="width:0%;"></div>
                            </div>
                            <!-- The extended global progress state -->
                            <div class="progress-extended">&nbsp;</div>
                        </div>
                    </div>
                    <!-- The table listing the files available for upload/download -->
                    <table role="presentation" class="table table-striped">
                        <tbody class="files" id="table_uploads_fill">
                            <tr class="template-download">
                                <td><b>Thumbnail</b></td><td><b>Name</b></td><td><b>Size</b></td><td><b>Meta</b></td><td><b>Action</b></td>
                            </tr>                          
                        </tbody>                            
                    </table>
                </form>			                        
			</div> <!-- ./ row -->                    			                       
        </div> <!-- ./ container -->          

        <!-- The blueimp Gallery widget -->
        <div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls" data-filter=":even">
            <div class="slides"></div>
            <h3 class="title"></h3>
            <a class="prev">‹</a>
            <a class="next">›</a>
            <a class="close">×</a>
            <a class="play-pause"></a>
            <ol class="indicator"></ol>
        </div>
        <!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
        <script src="/static/upload/js/jquery.ui.widget.js"></script>        
        <!-- The Templates plugin is included to render the upload/download listings -->
        <script src="//blueimp.github.io/JavaScript-Templates/js/tmpl.min.js"></script>
        <!-- The Load Image plugin is included for the preview images and image resizing functionality -->
        <script src="//blueimp.github.io/JavaScript-Load-Image/js/load-image.all.min.js"></script>
        <!-- The Canvas to Blob plugin is included for image resizing functionality -->
        <script src="//blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>        
        <!-- blueimp Gallery script -->
        <script src="//blueimp.github.io/Gallery/js/jquery.blueimp-gallery.min.js"></script>
        <!-- The basic File Upload plugin -->
        <script src="/static/upload/js/jquery.fileupload.js"></script>
        <!-- The File Upload processing plugin -->
        <script src="/static/upload/js/jquery.fileupload-process.js"></script>
        <!-- The File Upload image preview & resize plugin -->
        <script src="/static/upload/js/jquery.fileupload-image.js"></script>        
        <!-- The File Upload validation plugin -->
        <script src="/static/upload/js/jquery.fileupload-validate.js"></script>        
        <!-- The File Upload user interface plugin -->
        <script src="/static/upload/js/jquery.fileupload-ui.js"></script>        
        <script>
            $(document).ready(function(){                
                $('#image-fileupload-form').fileupload({
                    url: '/manage/{{ project_id }}/visuals/add/',                
                    filesContainer: $('#table_uploads_fill'),
                    acceptFileTypes: /(\.|\/)(jpe?g|png)$/i,
                    maxFileSize: 5000000, // 5 MB
                    maxNumberOfFiles: 100,
                    uploadTemplateId: null,
                    downloadTemplateId: null,                    
                    downloadTemplate: function (o) {                          
                        var rows = $();
                        $.each(o.files, function (index, file) {    //always 1 file                           
                            //console.log("meta:"+file.meta);
                            var row = $(                                
                                '<tr class="template-download fade">' +
                                '<td><span class="preview"></span></td>' +
                                '<td><p class="name"></p>' +
                                (file.error ? '<div class="error"></div>' : '') +
                                '</td>' +
                                '<td><span class="size"></span></td>' +                                
                                '<td><a class="meta" href="'+file.meta+'">'+file.meta+'</a></td>'+
                                '<td><button class="btn btn-danger delete" data-type="DELETE"><i class="icon icon-trash icon-white"></i><span>Delete visual</span></button> <input type="checkbox" name="delete" value="1" class="toggle"></td>' +
                                '</tr>');
                            row.find('.size').text(o.formatFileSize(file.size));
                            //id="edit-link-'+index+'"
                            if (file.error) {
                                row.find('.name').text(file.name);
                                row.find('.error').text(file.error);
                            } else {
                                row.find('.name').append($('<a></a>').text(file.name));
                                if (file.thumbnailUrl) {
                                    row.find('.preview').append(
                                        $('<a></a>').append(
                                            $('<img>').prop('src', file.thumbnailUrl)
                                        )
                                    );
                                }
                                row.find('a')
                                    .attr('data-gallery', '')
                                    .prop('href', file.url);
                                row.find('button.delete')
                                    .attr('data-type', file.delete_type)
                                    .attr('data-url', file.delete_url);
                                row.find('a.meta')    
                                    .removeAttr('data-gallery')
                                    .prop('href','#');                                    
                                row.find('.editable.editable-empty')
                                    .removeAttr('data-gallery')
                                    .prop('href','#');                                                                 
                            }
                            rows = rows.add(row);
                        });
                        return rows;
                    },
                    uploadTemplate: function (o) {                        
                        var rows = $();
                        $.each(o.files, function (index, file) {                            
                            var row = $('<tr class="template-upload fade">' +
                                '<td><span class="preview"></span></td>' +
                                '<td><p class="name"></p>' +
                                (file.error ? '<div class="error"></div>' : '') +
                                '</td>' +
                                '<td><p class="size"></p>' +
                                '<td class="meta"><a href="#" class="editable editable-empty" data-type="text" data-original-title="" title="" data-name="" data-title="Enter visual meta data (URL)" data-placeholder="Required">click to edit meta</a></td>'+
                                (o.files.error ? '' : '<div class="progress"></div>') +
                                '</td>' +
                                '<td>' +
                                (!o.files.error && !index && !o.options.autoUpload ?
                                    '<button class="btn start">Submit visual</button>' : '') +
                                (!index ? '<button class="btn cancel">Cancel</button>' : '') +
                                '</td>' +
                                '</tr>');
                            row.find('.name').text(file.name);
                            row.find('.size').text(o.formatFileSize(file.size));
                            if (file.error) {
                                row.find('.error').text(file.error);
                            }                
                            rows = rows.add(row);
                        });         
                        return rows;
                    }
                });            
                // editable activation
                $('#image-fileupload-form').bind('fileuploadprocessdone', function (e, data) {
                   $('.editable.editable-empty').editable({value: ""});                    
                }); 
                // meta field binding
                $('#image-fileupload-form').bind('fileuploadsubmit', function(e, data) {
                    data.formData = {}
                    var metas = data.context.find('a.editable');
                    data.formData['meta'] = metas[0].innerText;                    
                });
            });   
        </script>                 
        {% include "/footer.html" %}
    </body>
</html>       
